digraph compiler_explorer {
    bgcolor=transparent;
    compound=true;
    nodesep=0.6;
    node [ color="#dddddd:#aaaaaa"; style=filled];
    edge [ dir=both ];
    outside [shape = parallelogram, rank="source"];

    cloudfront [shape = oval];

    alb [shape = box, label="Application Load Balancer"];

    subgraph cluster_ce_nodes {
        label = "Prod Nodes";
        style = filled;
        color="#99dd99";

        ce_node_1 [shape = box, label="EC2"];
        ce_node_2 [shape = box, label="EC2"];
    }
    subgraph cluster_beta_nodes {
        label="Beta Nodes";
        style = filled;
        color="#dd99dd";
        beta_node_1 [shape = box, label="EC2"];
    }

    admin [shape = box, rank="sink", label="admin\nEC2"];

    efs [shape = folder];
    s3 [shape = folder];
    dynamodb [shape = cylinder];

    outside -> cloudfront;
    cloudfront -> alb;

    alb -> ce_node_1 [lhead=cluster_ce_nodes];
    alb -> ce_node_2 [lhead=cluster_ce_nodes];
    alb -> beta_node_1 [lhead=cluster_beta_nodes];

    build [ shape=box, label="Compiler Builder\nEC2"];

    admin->build;
    build->s3;

    admin -> {efs, s3, dynamodb };
    { ce_node_1, ce_node_2} -> admin [ltail=cluster_ce_nodes];
    { ce_node_1, ce_node_2} -> efs [ltail=cluster_ce_nodes];
    { ce_node_1, ce_node_2} -> s3 [ltail=cluster_ce_nodes];
    { ce_node_1, ce_node_2} -> dynamodb [ltail=cluster_ce_nodes];
    { beta_node_1 } -> admin [ltail=cluster_beta_nodes];
    { beta_node_1 } -> efs [ltail=cluster_beta_nodes];
    { beta_node_1 } -> s3 [ltail=cluster_beta_nodes];
    { beta_node_1 } -> dynamodb [ltail=cluster_beta_nodes];
}
